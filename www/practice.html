<!DOCTYPE html>
<html>
<haed>
    <link rel="stylesheet" href="css/common.css" type="text/css">
    <link rel="stylesheet" href="css/button.css" type="text/css">
    <link rel="stylesheet" href="css/practice.css" type="text/css">
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="js/history.js"></script>
    <script type="text/javascript" src="cordova.js"></script>
    <script type="text/javascript" src="js/upvideo_test.js"></script>
    
</haed>

<body>
    <div class='top'><b>跟练模式</div>
    <div class='show'>
        <video style="height:auto;" src="img/liugenghong.mp4" id="video0" controls="controls" width="100%"></video>
    </div>

    <!-- 预览视频，检测用 -->
    <!-- <h3>预览视频，检测用</h3>
    <video style="height:auto;" src="" id="video2up" controls="controls" width="100%"></video> -->

    <div class="item button-pulse" id="uploadbut" style="--bg-color: rgb(173, 173, 173);">
        <div class="button__wrapper">
            <div class="pulsing"></div>
            <input type="file" style="height:100%;width: 100%;position: absolute;display: none;" name='video' id='upvideo' onchange="upvideochange()"/>
            <button>
            <label for="upvideo" >
                <span>本地上传</span>
            </label>    
            </button>
            
            
             
        </div>
    </div>
    <div class="item button-pulse" id="picloadbut" style="--bg-color: rgb(173, 173, 173);">
        <div class="button__wrapper">
            <div class="pulsing"></div>
            <button >视频录制</button>
        </div>
    </div>
</body>

<!-- 前端对视频上传格式做简单校验 -->
<script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.js"></script>
<script>
    var upcheck;
    // hTML5实现表单内的上传文件框，上传前预览视频，刷新预览video，使用HTML5 的File API,
    // 建立一个可存取到该file的url，一个空的video标签，ID为video0,把选择的文件显示在video标签中，实现视频预览功能。
    // 需要选择支持HTML API的浏览器。
    $("#upvideo").change(function () {
        var objUrl = getObjectURL(this.files[0]);
        console.log("objUrl = " + objUrl);
        if (objUrl) {
            $("#video2up").attr("src", objUrl);
        }
        var  filePath=$( this ).val();
        if (filePath.indexOf( "mp4" )!=-1 || filePath.indexOf( "png" )!=-1){
            //修改允许类型
            $( ".fileerrorTip1" ).html( "" ).hide();
            var  arr=filePath.split( '\\' );
            var  fileName=arr[arr.length-1];
            $( ".showFileName1" ).html(fileName);
            alert("上传成功！关闭后跳转")
            window.location.href='result_compare.html'
            upcheck=true;
        } else {
            $( ".showFileName1" ).html( "" );
            $( ".fileerrorTip1" ).html( "您未上传文件，或者您上传文件类型有误！" ).show();
            upcheck=false;
            alert("未选择视频或类型有误，上传失败！")
            upcheck=false;
        }
    });
    //建立一个可存取到该file的url
    function getObjectURL(file) {
        var url = null;
        if (window.createObjectURL != undefined) { // basic
            url = window.createObjectURL(file);
        } else if (window.URL != undefined) { // mozilla(firefox)
            url = window.URL.createObjectURL(file);
        } else if (window.webkitURL != undefined) { // webkit or chrome
            url = window.webkitURL.createObjectURL(file);
        }
        return url;
    }

</script>